name: Spellcheck & Fix Typos

on:
  workflow_dispatch:
  push:
    branches:
      - "main"
    tags-ignore:
      - "*"

permissions:
  contents: write
  pull-requests: write
  actions: write

jobs:
  typos:
    if: startsWith(github.ref, 'refs/heads/')
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@1af3b93b6815bc44a9784bd300feb67ff0d1eeb3
        with:
          persist-credentials: false

      - name: Install typos
        uses: crate-ci/typos@40ff9f1340592d65961ba3bcabac76f810c44d9c
        env:
          INSTALL_DIR: ${{ runner.temp }}
        with:
          files: .
          config: typos.toml
          write_changes: true
        id: typos

      - name: Set up Git user
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      - name: Create Pull Request with fixes
        uses: NanashiTheNameless/create-pull-request@54090d376ec2f57a75a38f70e405cdf68933eed4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          branch: chore/typos-auto-fixes
          commit-message: "chore(typos): auto-fix spelling errors"
          title: "chore(typos): auto-fix spelling errors"
          body: |
            Automated spelling corrections using the typos action.
            - Action: crate-ci/typos
            - Config: typos.toml

            If this PR touches unintended files, adjust `typos.toml` exclusions or accepted words.
          labels: chore
          delete-branch: true
          signoff: false

      - name: Post summary
        if: always()
        run: |
          echo "Typos action completed. If changes were made, a PR was opened."
